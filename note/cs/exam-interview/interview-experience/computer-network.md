## 讲讲计算机网络体系结构

我们现在通常把计算机网络分为`5`层来讨论(理论模型)，它是结合了国际标准化组织ISO提出的`OSI`七层网络模型和`现实中`应用最广泛的`TCP/IP`四层网络模型而提出的，它去除了七层网络模型很多不必要的细节，同时又细分了`TCP/IP`四层模型结构。

![Network_Structure](https://cdn.jsdelivr.net/gh/1907-peng/pictures/img/Network_Structure.png)

### 那为什么要把计算机网络分为若干层这种结构呢？

```
这是从系统设计者的角度来看待这个问题了，不是从程序员的角度吧。
```

计算机网络就是要解决计算机之间的通信的问题。我们通常解决一个大的问题的时候，通常采取的思路是会把这个问题分解为若干子问题，然后分别取解决这些子问题，最终解决整个问题。对计算机网络进行分层，正是采用这种思路，每个不同层面解决不同的问题，然后这些层相互协作，最终实现计算机的通信。

优点：

1. 系统结构清晰，各层之间相互独立，便于维护。各层之间定义好通信接口，当我们在某一层工作时，并不要其它层面的具体实现，只需要关注接口是否发生改变就行了。（若让你解释接口的作用：你就拿电脑上面的USB接口举例，这个接口既能插鼠标，也能插键盘，还能插U盘，多方便）。

### 各层的功能以及协议

## 应用层

### Http协议

#### 什么是超文本传输协议

超文本：超越了普通文本的文本，即在一个文档中，包含有跳转到其它文本，视频，图片资源的链接。

定义：

> 在互联网的两点之间传输图片，视频，文字等超文本的规范。

#### 输入网址到显示网页，中间经历了什么？

##### 解析URL

##### 域名解析

即找到输入的网址域名对应的IP地址，

#### Http常见状态码

#### Http常见字段

Host：目标网站域名

Content-Length：本次响应的数据长度。

```java
Content-Length: 1000
/*
该字段的含义是本次响应的数据长度是1000字节，后面的字节是属于下一个响应
*/
```

Connection：请求服务器使用TCP持久连接，以便其它请求复用。HTTP/1.1 版本的默认连接都是持久连接，但为了兼容老版本的 HTTP，需要指定 `Connection` 首部字段的值为 `Keep-Alive`。

```java
Connection: keep-alive
```

Content-Type：用于服务器发送的响应中告诉客户端，该响应的内容的类型。

![content_type](https://cdn.jsdelivr.net/gh/1907-peng/pictures/img/content_type.png)

上图表明本次响应的类型是html，且使用得`utf-8`编码。

客户端发送请求的时候，可以发送`Accept`字段指明可以接受的数据类型。上图表明客户端接受任意类型的数据。

Content-Encoding：表示服务器返回的数据使用的是什么压缩格式。

![content_encoding](https://cdn.jsdelivr.net/gh/1907-peng/pictures/img/content_encoding.png)

Accept_Encoding：说明客户端接受哪些类型的压缩格式。

#### Get和Post方法的区别

仅有语义（单词本身代表的含义）上的区别[^1]。在技术上Get方法能够做到的事情，实际上Post也都能做到。Post能做到的事情，Get方法也能做到。

即`Get`方法被设计用来从服务器拿数据。

`Post`方法用来向服务器发送数据，并且服务器存储该数据。

#### Http协议的特征

想想那个http的报文。

##### 优点

- 简单

   报文结构简单，是`header+body`的形式。而且header又是键值对的形式，容易上手和使用。

- 灵活和可扩展性性强

   报文的请求方法，状态码，请求头都没有被固定死，允许开发人员自己进行定义。

   且http是应用层的协议，下面传输层的协议既可以是TCP，也可以是UDP。
   
- 应用广泛和跨平台

##### 缺点（待学习）

- 无状态的缺点

   每个请求包含了服务器能够处理该请求的所有信息。服务器处理同一个客户端发送的请求的时候，并不记得之前该客户端发送过的请求。当处理那些具有关联性的请求的时候，例如购物网站：先登录，再下单，付款。下单，付款这些请求都需要服务器知道是哪个登录过的用户，即包含登录者的相关信息。

- 明文传输不安全

- 不验证通信方的身份，因此有可能遭遇伪装

   `http`建立在`tcp`协议之上，`tcp`协议不能实现上面这个功能吗？

   http协议使用域名，域名要被解析为`ip`地址，（`域名解析`这个过程一定安全可信吗——这是DNS该关心的，与http协议无关），（如果域名解析正确，客户端知道了目标服务器的ip地址，但是在客户端发送请求之后，一定能到达正确的目标服务器吗？——这个是网络层该关心的）

   

[参考]: D:\天翼云盘同步盘\Markdown笔记\学习笔记\计算机\计算机基础\网络\应用层\HTTP协议.md



#### Get和Post方法都是安全且幂等的吗

安全：是指请求方法不会破坏服务器上的资源。

幂等：指的是同样的请求`被执行一次`与`连续执行多次`的`效果`是一样的，服务器的`状态`也是一样的。

按照 RFC 规范定义的语义来实现 GET 和 POST 方法，则GET方法是安全且幂等的，POST方法是不安全且不幂等的，PUT方法就是幂等的。

#### Http缓存技术（待学习）

若http请求的数据相同，则没必要每次都去服务器上拿去资源，可以把这些资源存储在本地或者代理服务器上。因此缓存分为私有缓存和共享缓存。

![http_cache](https://cdn.jsdelivr.net/gh/1907-peng/pictures/img/http_cache.png)

私有缓存：指将缓存资源保存在客户端本地。

共享缓存：存储在代理服务器上的缓存。

这里不讨论共享缓存。

##### 强制缓存

原理：在浏览器第一次向服务器请求某资源并成功得到该资源时，其响应的中包含有`Cache-Control`或者`Expires`字段，浏览器就会在本地保存该资源。当浏览器再次请求该资源时，首先判断该资源在本地是否有缓存。



##### 协商缓存

协商缓存就是与服务端协商之后，通过协商结果来判断是否使用本地缓存。























## 传输层

### TCP的三次握手和四次挥手

#### 为什么需要3次握手

#### 在第2次握手中传回了ACK，为什么还要传回SYN（待学习）

ACK，SYN各自代表什么含义？

即ACK的值是代表了对上一个接受的数据包的`Sequence number` + 1。

#### 如果不断开连接会怎么样呢？关闭连接为什么要四次挥手？

问题一：建立连接，即在客户端和服务器端存在一对`套接字`，从Linux程序来讲一个`套接字`是一个有`描述符的打开文件`,一个套接字作为通信的一个`端点`,而一个`套接字`有一个`套接字地址`，`IP套接字地址`的结构如下：

```c
/*IP socket address structure*/
struct sockaddr_in {
    unit16_t	sin_family;	/*Protocol family (always AF_INET)*/
    unit16_t	sin_port;	/*Port number in network byte order(大端法)*/
    struct in_addr	sin_addr;/*IP address int network byte order(大端法)*/
    unsigned char sin_zero[8];
};
```

因此，若服务器上建立的连接很多，而且都不关闭的话，内存就不够用了。因此若不需要进行通信之后，要及时关闭连接。

问题二：因为TCP连接是`全双工通信`，也就是说客户端或者服务器端能`同时`向对方`发送`数据，`并且接受`来自对方的数据。所以关闭连接是要关闭两条通信路径，一条是从`客户端->服务器`的`发送，接受`路径。另外一条是从`服务器->客户端`的`发送，接受`路径。所以任何一方发送结束连接报文的时候，意味着发送方要关闭与接收方之间的`发送，接受路径`，也就是第一次挥手和第二次挥手。但是此时还有接收方->发送方的`发送连接，接受路径`没有关闭，此时接收方还能继续向发送方发送数据，当接收方发送数据完毕之后，再发送结束连接报文，然后接受方确认之后，才能说完全关闭了TCP连接。

### TCP协议如何保证可靠传输

校验和机制：

- 作用：为了保证TCP报文在传输过程不会发生变化，保证数据的正确性。

- 具体内容：TCP报文会在首部中加入一个叫做校验和的字段，它的值是根据TCP伪首部，TCP首部和TCP数据计算得到的一个数值，接收者接受到这个TCP报文进行同样的操作，即计算校验和，然后与TCP报文中得校验和进行比较是否相同，即可验证TCP报文内容是否在发送过程中发生了变化。

流量控制：

- 作用：TCP连接的数据发送方发送数据包，接收方会把数据包放在缓冲区里。若发送方速度过快，缓冲区就会满，当缓冲区满了之后，会把已经收到的数据包扔掉，但是大量的丢弃数据包会浪费网络资源。因此我们需要对发送方的发送速度进行控制。
- 解决办法：滑动窗口
- 具体内容：



### TCP和UDP的区别





[^1]: 参考文献：https://ipotato.me/article/66

